<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <text>加载预约详情中...</text>
  </view>

  <!-- 错误状态 -->
  <view wx:if="{{error && !loading}}" class="error">
    <text>{{errorMsg || '获取数据失败'}}</text>
    <button bindtap="retry" class="retry-btn">重试</button>
  </view>

  <!-- 预约详情 -->
  <view wx:if="{{!loading && !error && reservationDetail}}" class="detail-container">
    <!-- 状态卡片 -->
    <view class="status-card" style="background-color: {{reservationDetail.status === '待使用' ? '#e6f4ff' : (reservationDetail.status === '使用中' ? '#e6f4ff' : (reservationDetail.status === '待支付' ? '#fff7e6' : (reservationDetail.status === '已完成' ? '#f6ffed' : '#fff1f0')))}};">
      <text class="status-text" style="color: {{reservationDetail.status === '待使用' ? '#1677ff' : (reservationDetail.status === '使用中' ? '#4A90E2' : (reservationDetail.status === '待支付' ? '#fa8c16' : (reservationDetail.status === '已完成' ? '#00b42a' : '#f53f3f')))}};">{{reservationDetail.status}}</text>
      <text wx:if="{{reservationDetail.paymentStatus && reservationDetail.status !== '待支付' && reservationDetail.status !== '已取消' && reservationDetail.status !== '已超时'}}" class="payment-status" style="color: {{reservationDetail.paymentStatus === '已支付' ? '#00b42a' : '#1677ff'}};">{{reservationDetail.paymentStatus}}</text>
    </view>

    <!-- 倒计时显示（立即预约模式） -->
    <view class="countdown-box" wx:if="{{isImmediateReservation && countdown > 0 && reservationDetail && reservationDetail.status === '待使用'}}">
      <text class="countdown-label">请在以下时间内到达，超时将自动取消：</text>
      <text class="countdown-time">{{countdownText}}</text>
    </view>

    <!-- 基本信息 -->
    <view class="section">
      <view class="section-header">
        <view class="section-title">预约信息</view>
        <view class="navigate-button-small" bindtap="navigateToParking">
          <text class="navigate-text-small">去这里</text>
        </view>
      </view>
      <view class="info-item">
        <text class="label">停车场：</text>
        <text class="value">{{reservationDetail.parkingName}}</text>
      </view>
      <view class="info-item">
        <text class="label">地址：</text>
        <text class="value">{{reservationDetail.parkingAddress}}</text>
      </view>
      <view class="info-item">
        <text class="label">车位号：</text>
        <text class="value">{{reservationDetail.spaceNumber}}</text>
      </view>
      <view class="info-item">
        <text class="label">预约时间：</text>
        <text class="value">{{reservationDetail.reserveTime}}</text>
      </view>
    </view>

    <!-- 使用信息 -->
    <view class="section">
      <view class="section-title">使用信息</view>
      <view class="info-item">
        <text class="label">开始时间：</text>
        <text class="value">{{reservationDetail.actualStartTime || '-'}}</text>
      </view>
      <view class="info-item">
        <text class="label">结束时间：</text>
        <text class="value">{{reservationDetail.actualEndTime || '-'}}</text>
      </view>
      <view class="info-item">
        <text class="label">预约金额：</text>
        <text class="value price">¥{{reservationDetail.amount}}</text>
      </view>
      <view class="info-item">
        <text class="label">创建时间：</text>
        <text class="value">{{reservationDetail.createTime}}</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button wx:if="{{reservationDetail.status === '待使用' && !reservationDetail.isUnlocked}}" bindtap="unlockSpace" class="pay-btn">立即解锁</button>
      <button wx:if="{{reservationDetail.status === '待使用' && !reservationDetail.isUnlocked}}" bindtap="cancelReservation" class="cancel-btn">取消预约</button>
      <button wx:if="{{reservationDetail.status === '使用中'}}" bindtap="completeReservation" class="complete-btn">结束订单</button>
      <button wx:if="{{reservationDetail.status === '待支付'}}" bindtap="payReservation" class="pay-btn">立即支付</button>
      <button bindtap="goBack" class="back-btn">返回</button>
    </view>
  </view>
</view>